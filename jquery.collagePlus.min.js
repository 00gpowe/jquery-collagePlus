/*!
 *
 * jQuery collagePlus Plugin v0.2.0
 * https://github.com/ed-lea/jquery-collagePlus
 *
 * Copyright 2012, Ed Lea twitter.com/ed_lea
 *
 * built for http://qiip.me
 *
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 *
 */
;(function($){$.fn.collagePlus=function(options){var settings=$.extend({'targetHeight':400,'albumWidth':this.width(),'padding':parseFloat(this.css('padding-left')),'images':this.children(),'fadeSpeed':"fast",'display':"inline-block"},options);return this.each(function(){var row=0,elements=[];settings.images.each(function(index){var $this=$(this),$img=($this.is("img"))?$this:$(this).find("img");var w=(typeof $img.data("width")!='undefined')?$img.data("width"):$img.width(),h=(typeof $img.data("height")!='undefined')?$img.data("height"):$img.height();var imgParams=getImgProperty($img);$img.data("width",w);$img.data("height",h);var nw=Math.ceil(w/h*settings.targetHeight),nh=Math.ceil(settings.targetHeight);elements.push([this,nw,nh,imgParams['w'],imgParams['h']]);var nwFull=nw+imgParams['w'];row+=((index<elements.length-1)?nwFull+settings.padding:nwFull);if(row>settings.albumWidth&&elements.length!=0){resizeRow(elements,row,settings);delete row;delete elements;row=0;elements=[]}if(settings.images.length-1==index&&elements.length!=0){resizeRow(elements,row,settings);delete row;delete elements;row=0;elements=[]}})});function resizeRow(obj,row,settings){var albumWidthAdjusted=settings.albumWidth-(settings.padding*(obj.length-1))-(obj.length*obj[0][3]),overPercent=albumWidthAdjusted/row;for(var i=0;i<obj.length;i++){var fw=Math.floor(obj[i][1]*overPercent),fh=Math.floor(obj[i][2]*overPercent),isLast=!!((i<obj.length-1));var $obj=$(obj[i][0]);$obj.width(fw);if($obj.not("img")){$obj.find("img").width(fw)}$obj.height(fh);if($obj.not("img")){$obj.find("img").height(fh)}applyModifications($obj,isLast,settings);$obj.animate({opacity:'1'},{duration:settings.fadeSpeed})}}function applyModifications($obj,isLast,settings){var css={'margin-bottom':settings.padding+"px",'margin-right':(isLast)?settings.padding+"px":"0px",'display':settings.display,'vertical-align':"bottom",'overflow':"hidden"};return $obj.css(css)}function getImgProperty(img){$img=$(img);var params=new Array();params["w"]=(parseFloat($img.css("border-left-width"))+parseFloat($img.css("border-right-width")));params["h"]=(parseFloat($img.css("border-top-width"))+parseFloat($img.css("border-bottom-width")));return params}}})(jQuery);